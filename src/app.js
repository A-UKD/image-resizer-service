// Ð†Ð¼Ð¿Ð¾Ñ€Ñ‚ÑƒÑ”Ð¼Ð¾ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ñ– Ð¼Ð¾Ð´ÑƒÐ»Ñ– Ñ‚Ð° Ñ„Ð°Ð¹Ð»Ð¸
import express from 'express';
import config from 'config';
import imageRoutes from './routes/imageRoutes.js';
import { scheduleCleanup } from './jobs/cleanupJob.js';
import { ensureImageDirectoryExists } from './utils/imageUtils.js';

// Ð—Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÑƒÑ”Ð¼Ð¾ Ñ–ÑÐ½ÑƒÐ²Ð°Ð½Ð½Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ñ–Ñ— Ð´Ð»Ñ Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½ÑŒ
ensureImageDirectoryExists();

// Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ Ð·Ð°Ð´Ð°Ñ‡Ñƒ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð½Ñ ÑÑ‚Ð°Ñ€Ð¸Ñ… Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½ÑŒ
scheduleCleanup();

// Ð—Ñ‡Ð¸Ñ‚ÑƒÑ”Ð¼Ð¾ Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ ÑÐµÑ€Ð²ÐµÑ€Ð° Ð· Ñ„Ð°Ð¹Ð»Ñƒ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—
const serverPort = config.get('server.port');

// Ð¡Ñ‚Ð²Ð¾Ñ€ÑŽÑ”Ð¼Ð¾ ÐµÐºÐ·ÐµÐ¼Ð¿Ð»ÑÑ€ Express-Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ°
const app = express();

// Ð”Ð¾Ð´Ð°Ñ”Ð¼Ð¾ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¸ Ð´Ð»Ñ Ð¾Ð±Ñ€Ð¾Ð±ÐºÐ¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñ–Ð² Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½ÑŒ
app.use('/images', imageRoutes);

// Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ”Ð¼Ð¾ ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° Ð²ÐºÐ°Ð·Ð°Ð½Ð¾Ð¼Ñƒ Ð¿Ð¾Ñ€Ñ‚Ñ–
app.listen(serverPort, () => {
    console.log(`ðŸ”¥ Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¾ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñ–: ${serverPort}`);
});